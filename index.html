<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.1">
<title>numba_mpi API documentation</title>
<meta name="description" content="&lt;img src=&#34;https://raw.githubusercontent.com/numba-mpi/numba-mpi/main/.github/numba_mpi_logo.svg&#34; style=&#34;height:50pt&#34; alt=&#34;numba-mpi logo&#34;&gt; numba-mpi â€¦">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Package <code>numba_mpi</code></h1>
</header>
<section id="section-intro">
<h1 id="numba-mpi"><img src="https://raw.githubusercontent.com/numba-mpi/numba-mpi/main/.github/numba_mpi_logo.svg" style="height:50pt" alt="numba-mpi logo"> numba-mpi</h1>
<p><a href="https://www.python.org/"><img alt="Python 3" src="https://img.shields.io/static/v1?label=Python&amp;logo=Python&amp;color=3776AB&amp;message=3"></a>
<a href="https://numba.pydata.org"><img alt="LLVM" src="https://img.shields.io/static/v1?label=LLVM&amp;logo=LLVM&amp;color=gold&amp;message=Numba"></a>
<a href="https://en.wikipedia.org/wiki/Linux"><img alt="Linux OK" src="https://img.shields.io/static/v1?label=Linux&amp;logo=Linux&amp;color=yellow&amp;message=%E2%9C%93"></a>
<a href="https://en.wikipedia.org/wiki/macOS"><img alt="macOS OK" src="https://img.shields.io/static/v1?label=macOS&amp;logo=Apple&amp;color=silver&amp;message=%E2%9C%93"></a>
<a href="https://en.wikipedia.org/wiki/Windows"><img alt="Windows OK" src="https://img.shields.io/static/v1?label=Windows&amp;logo=Windows&amp;color=white&amp;message=%E2%9C%93"></a>
<a href="https://github.com/numba-mpi/numba-mpi/actions/workflows/tests+pypi.yml"><img alt="Github Actions Status" src="https://github.com/numba-mpi/numba-mpi/workflows/tests+pypi/badge.svg?branch=main"></a>
<a href="https://GitHub.com/numba-mpi/numba-mpi/graphs/commit-activity"><img alt="Maintenance" src="https://img.shields.io/badge/Maintained%3F-yes-green.svg"></a>
<a href="https://www.gnu.org/licenses/gpl-3.0.html"><img alt="License: GPL v3" src="https://img.shields.io/badge/License-GPL%20v3-blue.svg"></a>
<a href="https://pypi.org/project/numba-mpi"><img alt="PyPI version" src="https://badge.fury.io/py/numba-mpi.svg"></a>
<a href="https://anaconda.org/conda-forge/numba-mpi"><img alt="Anaconda-Server Badge" src="https://anaconda.org/conda-forge/numba-mpi/badges/version.svg"></a>
<a href="https://aur.archlinux.org/packages/python-numba-mpi"><img alt="AUR package" src="https://repology.org/badge/version-for-repo/aur/python:numba-mpi.svg"></a>
<a href="https://zenodo.org/badge/latestdoi/316911228"><img alt="DOI" src="https://zenodo.org/badge/316911228.svg"></a></p>
<h3 id="overview">Overview</h3>
<p>numba-mpi provides Python wrappers to the C MPI API callable from within <a href="https://numba.readthedocs.io/en/stable/user/jit.html">Numba JIT-compiled code</a> (@njit mode).</p>
<p>Support is provided for a subset of MPI routines covering: <code>size</code>/<code>rank</code>, <code>send</code>/<code>recv</code>, <code>allreduce</code>, <code>bcast</code>, <code>scatter</code>/<code>gather</code> &amp; <code>allgather</code>, <code>barrier</code>, <code>wtime</code>
and basic asynchronous communication with <code>isend</code>/<code>irecv</code> (only for contiguous arrays); for request handling including <code>wait</code>/<code>waitall</code>/<code>waitany</code> and <code>test</code>/<code>testall</code>/<code>testany</code>.</p>
<p>The API uses NumPy and supports both numeric and character datatypes (e.g., <code>broadcast</code>).
Auto-generated docstring-based API docs are published on the web: <a href="https://numba-mpi.github.io/numba-mpi">https://numba-mpi.github.io/numba-mpi</a></p>
<p>Packages can be obtained from
<a href="https://pypi.org/project/numba-mpi">PyPI</a>,
<a href="https://anaconda.org/conda-forge/numba-mpi">Conda Forge</a>,
<a href="https://aur.archlinux.org/packages/python-numba-mpi">Arch Linux</a>
or by invoking <code>pip install git+https://github.com/numba-mpi/numba-mpi.git</code>.</p>
<p>numba-mpi is a pure-Python package.
The codebase includes a test suite used through the GitHub Actions workflows (<a href="https://github.com/mpi4py/setup-mpi">thanks to mpi4py's setup-mpi</a>!)
for automated testing on: Linux (<a href="https://www.mpich.org/">MPICH</a>, <a href="https://www.open-mpi.org/doc/">OpenMPI</a>
&amp; <a href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/mpi-library.html">Intel MPI</a>),
macOS (<a href="https://www.mpich.org/">MPICH</a> &amp; <a href="https://www.open-mpi.org/doc/">OpenMPI</a>) and
Windows (<a href="https://docs.microsoft.com/en-us/message-passing-interface/microsoft-mpi">MS MPI</a>).</p>
<p>Features that are not implemented yet include (help welcome!):
- support for non-default communicators
- support for <code>MPI_IN_PLACE</code> in <code>[all]gather</code>/<code>scatter</code> and <code>allreduce</code>
- support for <code>MPI_Type_create_struct</code> (Numpy structured arrays)
- &hellip;</p>
<h3 id="hello-world-sendrecv-example">Hello world send/recv example:</h3>
<pre><code class="language-python">import numba, numba_mpi, numpy

@numba.njit()
def hello():
    src = numpy.array([1., 2., 3., 4., 5.])
    dst_tst = numpy.empty_like(src)

    if numba_mpi.rank() == 0:
        numba_mpi.send(src, dest=1, tag=11)
    elif numba_mpi.rank() == 1:
        numba_mpi.recv(dst_tst, source=0, tag=11)

hello()
</code></pre>
<h3 id="example-comparing-numba-mpi-vs-mpi4py-performance">Example comparing numba-mpi vs. mpi4py performance:</h3>
<p>The example below compares <code>Numba</code>+<code>mpi4py</code> vs. <code>Numba</code>+<code>numba-mpi</code> performance.
The sample code estimates $\pi$ by numerical integration of $\int_0^1 (4/(1+x^2))dx=\pi$
dividing the workload into <code>n_intervals</code> handled by separate MPI processes
and then obtaining a sum using <code>allreduce</code> (see, e.g., analogous <a href="https://www.mathworks.com/help/parallel-computing/numerical-estimation-of-pi-using-message-passing.html">Matlab docs example</a>).
The computation is carried out in a JIT-compiled function <code>get_pi_part()</code> and is repeated
<code>N_TIMES</code>. The repetitions and the MPI-handled reduction are done outside or
inside of the JIT-compiled block for <code>mpi4py</code> and <code>numba-mpi</code>, respectively.
Timing is repeated <code>N_REPEAT</code> times and the minimum time is reported.
The generated plot shown below depicts the speedup obtained by replacing <code>mpi4py</code>
with <code><a title="numba_mpi" href="#numba_mpi">numba_mpi</a></code>, plotted as a function of <code>N_TIMES / n_intervals</code> - the number of MPI calls per
interval. The speedup, which stems from avoiding roundtrips between JIT-compiled
and Python code is significant (150%-300%) in all cases. The more often communication
is needed (smaller <code>n_intervals</code>), the larger the measured speedup. Note that nothing
in the actual number crunching (within the <code>get_pi_part()</code> function) or in the employed communication logic
(handled by the same MPI library) differs between the <code>mpi4py</code> or <code>numba-mpi</code> solutions.
These are the overhead of <code>mpi4py</code> higher-level abstractions and the overhead of
repeatedly entering and leaving the JIT-compiled block if using <code>mpi4py</code>, which can be
eliminated by using <code>numba-mpi</code>, and which the measured differences in execution time
stem from.</p>
<pre><code class="language-python">import timeit, mpi4py, numba, numpy as np, numba_mpi

N_TIMES = 10000
RTOL = 1e-3

@numba.jit
def get_pi_part(n_intervals=1000000, rank=0, size=1):
    h = 1 / n_intervals
    partial_sum = 0.0
    for i in range(rank + 1, n_intervals, size):
        x = h * (i - 0.5)
        partial_sum += 4 / (1 + x**2)
    return h * partial_sum

@numba.jit
def pi_numba_mpi(n_intervals):
    pi = np.array([0.])
    part = np.empty_like(pi)
    for _ in range(N_TIMES):
        part[0] = get_pi_part(n_intervals, numba_mpi.rank(), numba_mpi.size())
        numba_mpi.allreduce(part, pi, numba_mpi.Operator.SUM)
        assert abs(pi[0] - np.pi) / np.pi &lt; RTOL

def pi_mpi4py(n_intervals):
    pi = np.array([0.])
    part = np.empty_like(pi)
    for _ in range(N_TIMES):
        part[0] = get_pi_part(n_intervals, mpi4py.MPI.COMM_WORLD.rank, mpi4py.MPI.COMM_WORLD.size)
        mpi4py.MPI.COMM_WORLD.Allreduce(part, (pi, mpi4py.MPI.DOUBLE), op=mpi4py.MPI.SUM)
        assert abs(pi[0] - np.pi) / np.pi &lt; RTOL

plot_x = [x for x in range(1, 11)]
plot_y = {'numba_mpi': [], 'mpi4py': []}
for x in plot_x:
    for impl in plot_y:
        plot_y[impl].append(min(timeit.repeat(
            f&quot;pi_{impl}(n_intervals={N_TIMES // x})&quot;,
            globals=locals(),
            number=1,
            repeat=10
        )))

if numba_mpi.rank() == 0:
    from matplotlib import pyplot
    pyplot.figure(figsize=(8.3, 3.5), tight_layout=True)
    pyplot.plot(plot_x, np.array(plot_y['mpi4py'])/np.array(plot_y['numba_mpi']), marker='o')
    pyplot.xlabel('number of MPI calls per interval')
    pyplot.ylabel('mpi4py/numba-mpi wall-time ratio')
    pyplot.title(f'mpiexec -np {numba_mpi.size()}')
    pyplot.grid()
    pyplot.savefig('readme_plot.svg')
</code></pre>
<p><img alt="plot" src="https://github.com/numba-mpi/numba-mpi/releases/download/tip/readme_plot.png"></p>
<h3 id="mpi-resources-on-the-web">MPI resources on the web:</h3>
<ul>
<li>MPI standard and general information:<ul>
<li><a href="https://www.mpi-forum.org/docs">https://www.mpi-forum.org/docs</a></li>
<li><a href="https://en.wikipedia.org/wiki/Message_Passing_Interface">https://en.wikipedia.org/wiki/Message_Passing_Interface</a></li>
</ul>
</li>
<li>MPI implementations:<ul>
<li>OpenMPI: <a href="https://www.open-mpi.org">https://www.open-mpi.org</a></li>
<li>MPICH: <a href="https://www.mpich.org">https://www.mpich.org</a></li>
<li>MS MPI: <a href="https://learn.microsoft.com/en-us/message-passing-interface">https://learn.microsoft.com/en-us/message-passing-interface</a></li>
<li>Intel MPI: <a href="https://intel.com/content/www/us/en/developer/tools/oneapi/mpi-library-documentation.html">https://intel.com/content/www/us/en/developer/tools/oneapi/mpi-library-documentation.html</a></li>
</ul>
</li>
<li>MPI bindings:<ul>
<li>Python: <a href="https://mpi4py.readthedocs.io">https://mpi4py.readthedocs.io</a></li>
<li>Python/JAX: <a href="https://mpi4jax.readthedocs.io">https://mpi4jax.readthedocs.io</a></li>
<li>Julia: <a href="https://juliaparallel.org/MPI.jl">https://juliaparallel.org/MPI.jl</a></li>
<li>Rust: <a href="https://docs.rs/mpi">https://docs.rs/mpi</a></li>
<li>C++: <a href="https://boost.org/doc/html/mpi.html">https://boost.org/doc/html/mpi.html</a></li>
<li>R: <a href="https://cran.r-project.org/web/packages/Rmpi">https://cran.r-project.org/web/packages/Rmpi</a></li>
</ul>
</li>
</ul>
<h3 id="acknowledgements">Acknowledgements:</h3>
<p>We thank <a href="https://github.com/numba-mpi/numba-mpi/graphs/contributors">all contributors</a> and users who reported feedback to the project
through <a href="https://github.com/numba-mpi/numba-mpi/issues">GitHub issues</a>.</p>
<p>Development of numba-mpi has been supported by the <a href="https://ncn.gov.pl/en">Polish National Science Centre</a> (grant no. 2020/39/D/ST10/01220),
the <a href="https://www.mpg.de/en">Max Planck Society</a> and the <a href="https://erc.europa.eu/">European Union</a> (ERC, EmulSim, 101044662).
We further acknowledge Polandâ€™s high-performance computing infrastructure <a href="https://plgrid.pl">PLGrid</a> (HPC Centers: <a href="https://www.cyfronet.pl/en">ACK Cyfronet AGH</a>)
for providing computer facilities and support within computational grant no. PLG/2023/016369.</p>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="numba_mpi.api" href="api/index.html">numba_mpi.api</a></code></dt>
<dd>
<div class="desc"><p>functions that are part of the package API</p></div>
</dd>
<dt><code class="name"><a title="numba_mpi.common" href="common.html">numba_mpi.common</a></code></dt>
<dd>
<div class="desc"><p>variables used across API implementation</p></div>
</dd>
<dt><code class="name"><a title="numba_mpi.utils" href="utils.html">numba_mpi.utils</a></code></dt>
<dd>
<div class="desc"><p>helper functions used across API implementation</p></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul>
<li><a href="#numba-mpi">numba-mpi</a><ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#hello-world-sendrecv-example">Hello world send/recv example:</a></li>
<li><a href="#example-comparing-numba-mpi-vs-mpi4py-performance">Example comparing numba-mpi vs. mpi4py performance:</a></li>
<li><a href="#mpi-resources-on-the-web">MPI resources on the web:</a></li>
<li><a href="#acknowledgements">Acknowledgements:</a></li>
</ul>
</li>
</ul>
</div>
<ul id="index">
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="numba_mpi.api" href="api/index.html">numba_mpi.api</a></code></li>
<li><code><a title="numba_mpi.common" href="common.html">numba_mpi.common</a></code></li>
<li><code><a title="numba_mpi.utils" href="utils.html">numba_mpi.utils</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.1</a>.</p>
</footer>
</body>
</html>
